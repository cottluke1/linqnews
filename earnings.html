<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linq - Energy Earnings Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Using Lexend for header and Inter for body -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            background-image: radial-gradient(ellipse 50% 35% at 50% 0%, rgba(255, 255, 255, 0.2) 0%, rgba(0, 0, 0, 0) 100%);
            color: #E0E0E0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        #header-placeholder .text-3xl { font-family: 'Lexend', sans-serif; }
        #header-placeholder .nav-link { font-family: 'Lexend', sans-serif; letter-spacing: -0.01em; }

        .page-content-wrapper {
            flex-grow: 1;
            padding-top: 80px;
            padding-bottom: 4rem;
            width: 100%;
            max-width: 1200px; 
            margin: 0 auto;
        }

        .calendar-page-title { font-size: 2.75rem; font-weight: 700; color: #FFFFFF; }
        .calendar-page-title .accent-text { color: #00BFFF; }
        .calendar-page-subtitle { font-size: 1.125rem; color: #A0A0A0; margin-top: 0.5rem; font-weight: 400; }

        .earnings-card {
            background-color: #121212;
            border: 1px solid #282828;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            position: relative;
        }
        .earnings-card:not(.locked):hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px -8px rgba(0, 191, 255, 0.25);
            border-color: #00BFFF;
        }
        .earnings-card.locked > .card-content {
             filter: blur(4px);
             pointer-events: none;
        }
        .locked-overlay {
            position: absolute; inset: 0; display: none; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(2px);
            border-radius: 0.75rem; cursor: pointer;
        }
        .earnings-card.locked .locked-overlay { display: flex; }
        .locked-overlay-content { text-align: center; color: white; padding: 1rem;}
        .locked-overlay-content h4 { font-size: 1.25rem; font-weight: 600; }
        .locked-overlay-content p { color: #b0b0b0; margin-top: 0.5rem; margin-bottom: 1rem; }
        .locked-overlay-content .upgrade-btn {
            background: #00BFFF; color: white; padding: 0.5rem 1.5rem; border-radius: 99px;
            text-decoration: none; font-weight: 500; transition: background-color 0.2s;
        }
        .locked-overlay-content .upgrade-btn:hover { background: #00A9E0; }

        .company-logo-placeholder {
            width: 48px; height: 48px; background-color: #282828; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 1.25rem; color: #00BFFF; border: 2px solid #333333;
        }
        .company-info h3 { font-size: 1.25rem; font-weight: 600; color: #FFFFFF; }
        .company-info .ticker { font-size: 0.9rem; color: #A0A0A0; }
        .detail-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.95rem; color: #B0B0B0; }
        .detail-item i { color: #00BFFF; width: 16px; text-align: center; }
        .detail-label { font-weight: 500; color: #E0E0E0; margin-right: 0.25rem; }
        .action-btn {
            background-color: #1A1A1A; color: #00BFFF; border: 1px solid #00BFFF;
            padding: 0.5rem 1rem; border-radius: 0.375rem; font-size: 0.8rem;
            font-weight: 500; display: inline-flex; align-items: center; gap: 0.5rem;
            transition: background-color 0.2s ease, color 0.2s ease; cursor: pointer;
        }
        .action-btn:hover { background-color: #00BFFF; color: #FFFFFF; }
        
        .footer {
            background-color: #080808; color: #A0A0A0; padding: 2.5rem 1rem;
            border-top: 1px solid #1A1A1A; text-align: center; font-size: 0.875rem;
            margin-top: auto;
        }
    </style>
</head>
<body class="antialiased">
    <div id="header-placeholder"></div>

    <div class="page-content-wrapper px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-10">
            <h1 class="calendar-page-title">Energy Sector <span class="accent-text">Earnings</span></h1>
            <p class="calendar-page-subtitle"></p>
            <a href="previous_earnings.html" class="inline-block text-white font-bold py-3 px-6 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-400 hover:from-blue-600 hover:to-cyan-500 transition-all duration-300 shadow-md hover:shadow-lg hover:shadow-cyan-500/50 transform hover:-translate-y-0.5">
                View Past Earnings
            </a>
        </div>

        <div id="earnings-container">
             <!-- Earnings cards will be dynamically inserted here -->
        </div>
    </div>

    <footer class="footer">
        <p>&copy; <span id="current-year"></span> Linq Energy Intelligence.</p>
    </footer>

    <script>
        // --- GLOBAL STATE & CONFIG ---
        let isSubscribed = false;
        let unsubscribeUserListener = null;
        // ** RESTORED: The data for the earnings calls **
        const earningsData = [
            { company: "ExxonMobil Corporation", ticker: "XOM", date: "2025-06-17", time: "09:00 AM ET", period: "Q2 2025", webcastUrl: "https://corporate.exxonmobil.com/investors/events-and-presentations" },
            { company: "NextEra Energy, Inc.", ticker: "NEE", date: "2025-06-18", time: "10:00 AM ET", period: "Q2 2025", webcastUrl: "https://www.investor.nexteraenergy.com/events-presentations" },
            { company: "Chevron Corporation", ticker: "CVX", date: "2025-06-24", time: "11:00 AM ET", period: "Q2 2025", webcastUrl: "https://www.chevron.com/investors/events-presentations" },
            { company: "Schlumberger Limited", ticker: "SLB", date: "2025-06-27", time: "08:30 AM ET", period: "Q2 2025", webcastUrl: "https://investorcenter.slb.com/financial-information/quarterly-results" },
            { company: "ConocoPhillips", ticker: "COP", date: "2025-07-02", time: "12:00 PM ET", period: "Q2 2025", webcastUrl: "https://www.conocophillips.com/investors/events-and-presentations/" },
            { company: "EOG Resources, Inc.", ticker: "EOG", date: "2025-07-08", time: "10:00 AM ET", period: "Q2 2025", webcastUrl: "https://investors.eogresources.com/events-and-presentations/default.aspx" }
        ];

        // --- FIREBASE SETUP ---
        const firebaseConfig = { 
            apiKey: "AIzaSyD_FCx8sIkrCoQMoKm5xQIvlyAmlqptETk",
            authDomain: "linq-b27a8.firebaseapp.com",
            projectId: "linq-b27a8",
            storageBucket: "linq-b27a8.appspot.com",
            messagingSenderId: "1067901051826",
            appId: "1:1067901051826:web:44452d1339cdbe2af07aab"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            fetch('header.html') 
                .then(response => response.ok ? response.text() : Promise.reject('Header fetch failed'))
                .then(data => {
                    const headerPlaceholder = document.getElementById('header-placeholder');
                    if (headerPlaceholder) {
                        headerPlaceholder.innerHTML = data;
                        auth.onAuthStateChanged(handleAuthStateChange);
                    }
                })
                .catch(error => console.error('Error fetching header:', error));
            
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });

        // --- AUTH & SUBSCRIPTION LOGIC ---
        function handleAuthStateChange(user) {
            updateHeaderUI(user);
            if (unsubscribeUserListener) unsubscribeUserListener();

            if (user) {
                unsubscribeUserListener = db.collection('users').doc(user.uid).onSnapshot(doc => {
                    isSubscribed = doc.exists && doc.data().isSubscribed === true;
                    renderEarnings(); 
                }, error => {
                    console.error("Error with real-time listener:", error);
                    isSubscribed = false;
                    renderEarnings();
                });
            } else {
                isSubscribed = false;
                renderEarnings();
            }
        }

        function updateHeaderUI(user) {
            const authLink = document.getElementById('authLinkDesktopLogin');
            const profileLink = document.getElementById('profileLinkDesktop');
            const profilePic = document.getElementById('navProfilePic');
            const logo = document.querySelector('.flex.items-center.space-x-4 > a.text-3xl.font-bold.text-white');
            if(logo) logo.classList.add('logo-font');
            
            document.querySelectorAll('.hidden.md\\:flex.flex-1.justify-center.space-x-8 > a').forEach(link => {
                link.classList.add('nav-link');
            });


            if (user) {
                if(authLink) authLink.classList.add('hidden');
                if(profileLink) profileLink.classList.remove('hidden');
                
                if (profilePic) {
                    if (user.photoURL) {
                        profilePic.src = user.photoURL;
                    } else if (user.displayName) {
                        profilePic.src = `https://placehold.co/40x40/2C2F33/EAEAEA?text=${user.displayName.charAt(0).toUpperCase()}`;
                    } else if (user.email) {
                        profilePic.src = `https://placehold.co/40x40/2C2F33/EAEAEA?text=${user.email.charAt(0).toUpperCase()}`;
                    } else {
                        profilePic.src = 'https://placehold.co/40x40/2C2F33/EAEAEA?text=U';
                    }
                }
            } else {
                if(authLink) authLink.classList.remove('hidden');
                if(profileLink) profileLink.classList.add('hidden');
            }
        }
        
        // --- DYNAMIC RENDERING ---
        function renderEarnings() {
            const container = document.getElementById('earnings-container');
            if (!container) return;
            container.innerHTML = ''; // Clear previous content

            const groupedByDate = earningsData.reduce((acc, call) => {
                const date = new Date(call.date).toDateString();
                if (!acc[date]) acc[date] = [];
                acc[date].push(call);
                return acc;
            }, {});

            Object.keys(groupedByDate).sort((a,b) => new Date(a) - new Date(b)).forEach(dateStr => {
                const titleEl = document.createElement('h2');
                titleEl.className = 'text-xl font-semibold text-white my-6 pb-2 border-b border-gray-700';
                titleEl.textContent = new Date(dateStr).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                container.appendChild(titleEl);

                groupedByDate[dateStr].forEach(call => {
                    const card = createEarningsCard(call);
                    container.appendChild(card);
                });
            });
        }

        function createEarningsCard(call) {
            const cardEl = document.createElement('div');
            cardEl.className = 'earnings-card';
            if (!isSubscribed) {
                cardEl.classList.add('locked');
            }
            
            const initials = call.ticker || call.company.substring(0, 3).toUpperCase();

            cardEl.innerHTML = `
                <div class="card-content flex flex-col gap-4">
                    <div class="flex items-center gap-4">
                        <div class="company-logo-placeholder"><span>${initials}</span></div>
                        <div class="company-info">
                            <h3>${call.company}</h3>
                            <p class="ticker">${call.ticker}</p>
                        </div>
                    </div>
                    <div class="earnings-details flex flex-col gap-2">
                        <div class="detail-item"><i class="fas fa-calendar-alt"></i><span class="detail-label">Date:</span>${new Date(call.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</div>
                        <div class="detail-item"><i class="fas fa-clock"></i><span class="detail-label">Time:</span>${call.time}</div>
                        <div class="detail-item"><i class="fas fa-chart-line"></i><span class="detail-label">Period:</span>${call.period}</div>
                    </div>
                    <div class="card-actions flex flex-wrap gap-3 mt-2">
                        <button class="action-btn add-to-calendar-btn" data-company="${call.company}" data-ticker="${call.ticker}" data-date="${call.date}" data-time="${call.time}" data-timezone="ET" data-period="${call.period}">
                            <i class="fas fa-calendar-plus"></i> Add to Calendar
                        </button>
                        <a href="${call.webcastUrl}" target="_blank" rel="noopener noreferrer" class="action-btn webcast-btn">
                            <i class="fas fa-broadcast-tower"></i> Webcast
                        </a>
                    </div>
                </div>
                <div class="locked-overlay" onclick="location.href='linqplus.html'">
                    <div class="locked-overlay-content">
                        <h4>Premium Feature</h4>
                        <p>Upgrade to view full earnings details.</p>
                        <a href="linqplus.html" class="upgrade-btn">Go Premium</a>
                    </div>
                </div>`;

            // Event listener for calendar button
            cardEl.querySelector('.add-to-calendar-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                if (!isSubscribed) {
                    window.location.href = 'linqplus.html';
                    return;
                }
                const { company, ticker, date, time, timezone, period } = this.dataset;
                const [year, month, day] = date.split('-').map(Number);
                let [hour, minute] = time.match(/\d+/g).map(Number);
                if(time.includes('PM') && hour !== 12) hour += 12;
                if(time.includes('AM') && hour === 12) hour = 0;

                let utcHour = timezone === "ET" ? hour + 4 : hour; 

                const startDateUtc = new Date(Date.UTC(year, month - 1, day, utcHour, minute));
                const endDateUtc = new Date(startDateUtc.getTime() + (60 * 60 * 1000));
                
                const formatDateToICS = d => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                
                const icsContent = [
                    'BEGIN:VCALENDAR', 'VERSION:2.0', 'PRODID:-//LinqAI//EarningsCalendar//EN',
                    'BEGIN:VEVENT',
                    `UID:${formatDateToICS(new Date())}-${ticker}@linq.ai`, `DTSTAMP:${formatDateToICS(new Date())}`,
                    `DTSTART:${formatDateToICS(startDateUtc)}`, `DTEND:${formatDateToICS(endDateUtc)}`,
                    `SUMMARY:${ticker} ${period} Earnings Call`, `DESCRIPTION:${company} (${ticker}) ${period} earnings call. Link: ${call.webcastUrl}`,
                    'END:VEVENT', 'END:VCALENDAR'
                ].join('\r\n');

                const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${ticker}_${period.replace(/\s+/g, '_')}_earnings.ics`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            return cardEl;
        }

    </script>
</body>
</html>
