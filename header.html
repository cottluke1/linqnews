<nav class="fixed top-0 left-0 w-full z-[1000] shadow-md py-3 bg-gray-900">
    <style>
        /* Prevent flash of content during auth state changes */
        .nav-link-button {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Hide elements initially until auth state is determined */
        .auth-dependent {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .auth-dependent.visible {
            opacity: 1;
            display: flex;
        }

        /* Increased spacing between profile and menu */
        .space-x-5 > * + * {
            margin-left: 1.25rem;
        }

        /* Ensure smooth transitions for auth area */
        #desktopAuthArea {
            min-height: 2.5rem; /* Prevent height collapse during transitions */
            opacity: 1 !important;
            display: flex !important;
        }

        /* Hide auth elements until Firebase is ready */
        .auth-loading * {
            visibility: hidden;
        }

        .auth-ready * {
            visibility: visible;
        }

        /* Profile icon and hamburger menu colors */
        .profile-icon-placeholder svg {
            color: white;
            width: 2rem;
            height: 2rem;
        }

        .desktop-hamburger-icon svg {
            color: white;
            width: 1.5rem;
            height: 1.5rem;
        }

        /* Auth state handling */
        #loginElements {
            display: flex;  /* Show by default for non-logged in state */
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        #profileAndMenuDesktop {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        #profileAndMenuDesktop.visible {
            display: flex;
            opacity: 1;
        }

        /* Navigation links */
        .nav-link {
            color: white;
            text-decoration: none;
        }

        .nav-link:hover {
            color: #e2e8f0;
        }

        /* Prevent login button flash */
        #authLinkDesktopLogin {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        #authLinkDesktopLogin.visible {
            opacity: 1;
        }
    </style>
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
        <a href="index.html" class="text-3xl font-bold text-white">Linq</a>
        <div class="hidden md:flex items-center space-x-5">
            <a href="index.html" class="nav-link text-sm">News</a>
            <a href="community.html" class="nav-link text-sm active">Community</a> 
            <a href="markets.html" id="marketsLinkDesktop" class="nav-link text-sm">Markets</a> 
            <div id="desktopAuthArea" class="flex items-center space-x-3">
                <div id="loginElements" class="flex items-center space-x-3">
                    <a href="login.html" id="authLinkDesktopLogin" class="nav-link text-sm">Login</a>
                    <div class="desktop-hamburger-menu">
                        <button id="desktop-hamburger-button-login" class="desktop-hamburger-icon text-white hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="profileAndMenuDesktop" class="items-center space-x-5">
                    <a href="profile.html" id="profileLinkDesktop" title="My Profile">
                        <div class="profile-icon-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </a>
                    <div class="desktop-hamburger-menu">
                        <button id="desktop-hamburger-button" class="desktop-hamburger-icon text-white hover:text-gray-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="md:hidden">
            <button id="mobile-menu-button" class="text-gray-300 hover:text-white focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>
    </div>
    <div id="mobile-menu" class="md:hidden hidden bg-gray-900 bg-opacity-90 backdrop-blur-md">
        <a href="login.html" id="authLinkMobile" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700">Login</a>
        <a href="linqai.html" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700">Linq Ai</a>
        <a href="earnings.html" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700">Earnings Calendar</a>
        <a href="index.html" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700">News</a> 
        <a href="community.html" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700 active">Community</a> 
        <a href="Markets.html" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700">Markets</a>
        <a href="favorites.html" id="favoritesLinkMobile" class="block nav-link text-sm px-4 py-3 hover:bg-gray-700 hidden">Favorites</a>
        <a href="#" id="logoutButtonMobile" class="hidden nav-link text-sm px-4 py-3 hover:bg-gray-700">Logout</a>
    </div>
</nav>

<div id="desktop-slideout-menu" class="slide-out-panel">
    <div class="slide-out-panel-header">
        <button id="slideout-close-button" class="slide-out-panel-close-btn" aria-label="Close menu">&times;</button>
    </div>
    <nav class="slide-out-panel-nav">
        <a href="linqai.html">Linq AI</a>
        <a href="earnings.html">Earnings Calendar</a>
        <a href="favorites.html">Favorites</a> 
        <a href="profile.html">My Profile</a>
        <a href="#" id="logoutButtonSlideout">Logout</a> 
    </nav>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyD_FCx8sIkrCoQMoKm5xQIvlyAmlqptETk",
        authDomain: "linq-b27a8.firebaseapp.com",
        projectId: "linq-b27a8",
        storageBucket: "linq-b27a8.firebasestorage.app",
        messagingSenderId: "1067901051826",
        appId: "1:1067901051826:web:44452d1339cdbe2af07aab"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Function to handle auth state changes
    function updateAuthUI(user) {
        const loginElements = document.getElementById('loginElements');
        const profileMenu = document.getElementById('profileAndMenuDesktop');
        
        if (user) {
            // User is logged in
            loginElements.style.display = 'none';
            profileMenu.classList.add('visible');
        } else {
            // User is not logged in
            loginElements.style.display = 'flex';
            profileMenu.classList.remove('visible');
        }
    }

    // Listen for auth state changes
    firebase.auth().onAuthStateChanged((user) => {
        updateAuthUI(user);
    });

    // Handle logout
    document.getElementById('logoutButtonSlideout').addEventListener('click', (e) => {
        e.preventDefault();
        firebase.auth().signOut().then(() => {
            window.location.href = 'index.html';
        }).catch((error) => {
            console.error('Error signing out:', error);
        });
    });

    // Handle login button in dropdown
    document.getElementById('desktop-hamburger-button-login').addEventListener('click', () => {
        window.location.href = 'login.html';
    });
</script>
