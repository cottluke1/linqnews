<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linq - Community Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* REDUCED: Removed redundant header styles. Only page-specific styles remain. */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            background-color: #000000;
            background-image: radial-gradient(ellipse 35% 15% at 50% 0%, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
            color: #E7E9EA;
            font-weight: 400;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        body.overflow-hidden {
            overflow: hidden;
        }
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1A1A1A; }
        ::-webkit-scrollbar-thumb { background-color: #333333; border-radius: 10px; border: 2px solid #1A1A1A; }
        ::-webkit-scrollbar-thumb:hover { background-color: #4A4A4A; }

        /* Page Specific Styles */
        .page-header { text-align: center; margin-bottom: 2.5rem; }
        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #E7E9EA;
            margin: 0 0 1rem 0;
            text-shadow: 0px 2px 10px rgba(0, 191, 255, 0.3);
        }
        .page-title .accent-text { color: #00BFFF; }
        .page-subtitle {
            font-size: 1.125rem;
            color: #6E767D;
            max-width: none;
            margin: 0;
            line-height: 1.6;
        }

        .search-container {
            margin-bottom: 2rem;
        }
        .search-input {
            width: 100%; padding: 0.875rem 1rem;
            background-color: #1A1A1A; border: 1px solid #333333; border-radius: 0.5rem;
            font-size: 1rem; color: #E0E0E0;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            line-height: normal; height: 3rem;
        }
        .search-input::placeholder { color: #777777; }
        .search-input:focus {
            border-color: #00BFFF; outline: none;
            box-shadow: 0 0 0 3px rgba(0, 191, 255, 0.25);
        }

        .filter-section-wrapper {
            flex: 1;
            min-width: 280px;
            order: 2;
        }
        .filter-panel {
            background-color: rgba(22, 22, 22, 0.7); backdrop-filter: blur(8px) saturate(130%);
            padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 15px -5px rgba(0, 0, 0, 0.4);
            border: 1px solid #2a2a2a; position: sticky;
            top: 100px;
        }
        .filter-title { font-size: 1.25rem; font-weight: 600; color: #E0E0E0; margin-bottom: 1.25rem; }
        .filter-button {
            display: block; width: 100%; text-align: left; padding: 0.75rem 1rem;
            margin-bottom: 0.5rem; border-radius: 0.375rem; color: #B0B0B0; font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
            background-color: #1A1A1A; border: 1px solid #333333;
            cursor: pointer;
        }
        .filter-button:hover {
            background-color: rgba(0, 191, 255, 0.1); color: #FFFFFF; border-color: #00BFFF;
        }
        .filter-button.active {
            background-color: rgba(0, 191, 255, 0.2); color: #FFFFFF; font-weight: 600;
            border-color: #00BFFF;
        }

        .post-card {
            background-color: #121212; border: 1px solid #2F3336; border-radius: 0.75rem;
            padding: 1.75rem; margin-bottom: 2rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            box-shadow: 0 4px 15px -5px rgba(0,0,0,0.4); display: flex; flex-direction: column;
        }
        .post-card:hover {
            transform: translateY(-5px); box-shadow: 0 10px 30px -10px rgba(0, 191, 255, 0.2);
            border-color: #5a6268;
        }
        .post-title {
            font-size: 1.375rem; font-weight: 600; color: #E7E9EA;
            margin: 0 0 0.75rem; line-height: 1.4;
        }
        .post-meta {
            font-size: 0.875rem; color: #6E767D; margin: 0 0 1rem; font-weight: 400;
            display: flex; align-items: center; flex-wrap: wrap;
        }
        .post-category-tag {
            background-color: rgba(0, 191, 255, 0.15); color: #00BFFF; padding: 0.3rem 0.875rem;
            border-radius: 1rem; font-size: 0.75rem; font-weight: 500;
            margin-left: 0.75rem; border: 1px solid rgba(0, 191, 255, 0.3);
        }
        
        /* FIXED: Added styles to prevent flash of unstyled content for tweets */
        .twitter-tweet-container {
            margin-top: 1rem;
            background-color: transparent;
            border-radius: 0.5rem;
            padding: 0;
            border: none;
            display: flex;
            justify-content: center;
            min-height: 120px; /* Reserve space to prevent layout shift */
        }
        .twitter-tweet-container.is-loading {
            visibility: hidden; /* Hide the blockquote until the widget is ready */
        }

        .post-actions {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 1.5rem;
            gap: 0.75rem;
            padding-top: 1rem;
            border-top: 1px solid #2F3336;
        }
        .action-btn {
            background-color: transparent; border: 1px solid #333333; color: #A0A0A0;
            border-radius: 0.375rem; padding: 0.5rem 0.75rem; font-size: 0.875rem;
            font-weight: 500; cursor: pointer; transition: all 0.2s ease;
            display: inline-flex; align-items: center; gap: 0.5rem;
        }
        .action-btn:hover { background-color: #1A1A1A; color: #00BFFF; border-color: #00BFFF; }
        .action-btn i { font-size: 1rem; }

        .favorite-btn {
            width: 2.25rem; height: 2.25rem; 
            color: #888888;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
            background: none;
            border: none;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .favorite-btn:hover {
            color: #00BFFF;
            transform: scale(1.15);
        }
        .favorite-btn svg {
            width: 100%;
            height: 100%;
            stroke-width: 1.5;
            stroke: currentColor;
            fill: none;
        }
        .favorite-btn.favorited svg {
            fill: #00BFFF;
            stroke: #00BFFF;
        }

        .share-confirmation {
            display: none;
            font-size: 0.75rem;
            color: #00BFFF;
            margin-right: auto;
            padding-left: 0;
        }

        .footer {
            background-color: #080808; color: #A0A0A0; padding: 2.5rem 1rem;
            border-top: 1px solid #1A1A1A; text-align: center; font-size: 0.875rem; margin-top: auto;
        }
        .footer a { color: #B0B0B0; transition: color 0.2s ease; }
        .footer a:hover { color: #00BFFF; }

        .page-content-wrapper {
            flex-grow: 1; padding-bottom: 4rem; width: 100%; max-width: 1200px;
            margin: 0 auto; padding-left: 1rem; padding-right: 1rem;
            padding-top: 120px; 
        }
        .community-main-grid { display: flex; flex-wrap: wrap; gap: 2rem; }
        .posts-section { flex: 3; min-width: 0; order: 1; }

        @media (max-width: 1023px) {
            .community-main-grid { flex-direction: column; }
            .posts-section, .filter-section-wrapper { flex: none; width: 100%; padding-top: 0; }
            .filter-panel { position: static; order: 0; margin-bottom: 2rem; top: auto; }
            .search-container { position: static; top: auto; }
            .filter-section-wrapper { padding-top: 0; }
        }
    </style>
</head>
<body class="antialiased">
    <!-- ‚úÖ 1. Add Static Header Spacer to Prevent Layout Jump -->
    <div style="height: 68px;" class="w-full bg-black border-b border-gray-800"></div>

    <!-- ‚úÖ 2. Add Header Placeholder -->
    <div id="header-placeholder"></div>

    <main class="page-content-wrapper">
        <header class="page-header">
            <h1 class="page-title">The <span class="accent-text">Linq</span> to Your Community</h1>
            <p class="page-subtitle">Real-Time Insights from Energy Experts</p>
        </header>

        <div class="community-main-grid">
            <section class="posts-section">
                <div class="search-container">
                    <input type="text" id="searchInputCommunity" placeholder="Search community posts..." class="search-input">
                </div>

                <div id="postsContainerCommunity" class="space-y-8"></div>
            </section>

            <aside class="filter-section-wrapper">
                <div class="filter-panel">
                    <h3 class="filter-title">Filter by Category</h3>
                    <div id="categoryFiltersCommunity" class="space-y-3">
                        <button class="filter-button" data-category="Crude oil">Crude Oil</button>
                        <button class="filter-button" data-category="Natural Gas">Natural Gas</button>
                        <button class="filter-button" data-category="Energy">General Energy</button>
                        <button class="filter-button" data-category="Policy">Policy & Markets</button>
                        <button class="filter-button" data-category="Market Analysis">Market Analysis</button>
                        <button class="filter-button" data-category="Energy Demand">Energy Demand</button>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; <span id="current-year-community"></span> Linq Energy Intelligence. All Rights Reserved.</p>
        <nav class="text-xs space-x-3 mt-2">
            <a href="#">Privacy Policy</a> |
            <a href="#">Terms of Service</a> |
            <a href="#">Contact Us</a>
        </nav>
    </footer>

    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

    <script>
        // --- GLOBAL STATE ---
        let communityFavorites = [];
        let unsubscribeUserListener = null;

        // --- FIREBASE SETUP ---
        // ‚úÖ 3. This part is now handled by the centralized script block at the end of the body
        const db = firebase.firestore();

        // --- DATA ---
        const communityPostsDataPage = [
            { id: 'tweet19', url: 'https://twitter.com/DavidInglesTV/status/1933357784646758533', title: 'Oil Prices Up Most in Half Decade', meta: 'June 13, 2025 ‚Ä¢ David Ingles (@DavidInglesTV)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">Oil prices up the most in half decade. We were at $59 five weeks ago. $80 now in sight. Brent crude up over 10% <a href="https://t.co/g9sMWWWm3y">pic.twitter.com/g9sMWWWm3y</a></p>&mdash; David Ingles (@DavidInglesTV) <a href="https://twitter.com/DavidInglesTV/status/1933357784646758533?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet18', url: 'https://twitter.com/marketplunger1/status/1933341930512953427', title: 'Crude Oil Knew.', meta: 'June 13, 2025 ‚Ä¢ Brandon Beylo (@marketplunger1)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">Crude oil knew.</p>&mdash; Brandon Beylo (@marketplunger1) <a href="https://twitter.com/marketplunger1/status/1933341930512953427?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet17', url: 'https://twitter.com/Josh_Young_1/status/1933327432804618625', title: 'Got Oil?', meta: 'June 13, 2025 ‚Ä¢ Josh Young (@Josh_Young_1)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">Got oil? <a href="https://t.co/fcW53lCkB9">https://t.co/fcW53lCkB9</a></p>&mdash; Josh Young (@Josh_Young_1) <a href="https://twitter.com/Josh_Young_1/status/1933327432804618625?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet16', url: 'https://twitter.com/anasalhajji/status/1933326226397040990', title: 'Israel Attacks Targets in Iran - Oil Prices Up 7%', meta: 'June 13, 2025 ‚Ä¢ Anas Alhajji (@anasalhajji)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">üî•üî•üî•Israel attacks targets in Iran... Oil prices increased by about 7% <a href="https://t.co/gjMgOIOeFm">pic.twitter.com/gjMgOIOeFm</a></p>&mdash; Anas Alhajji (@anasalhajji) <a href="https://twitter.com/anasalhajji/status/1933326226397040990?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet15', url: 'https://twitter.com/anasalhajji/status/1933354029297643953', title: 'WTI Up By About 13%', meta: 'June 13, 2025 ‚Ä¢ Anas Alhajji (@anasalhajji)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">üí•ÔøΩüí•WTI is up by about 13% <a href="https://t.co/6dIOwlDVzu">https://t.co/6dIOwlDVzu</a></p>&mdash; Anas Alhajji (@anasalhajji) <a href="https://twitter.com/anasalhajji/status/1933354029297643953?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet14', url: 'https://twitter.com/Josh_Young_1/status/1933337112373293452', title: 'The Sound of "Experts" Deleting Bearish Oil Posts', meta: 'June 13, 2025 ‚Ä¢ Josh Young (@Josh_Young_1)', category: 'Market Analysis', tweetContent: '<p lang="en" dir="ltr">The sound of &quot;experts&quot; deleting bearish oil posts</p>&mdash; Josh Young (@Josh_Young_1) <a href="https://twitter.com/Josh_Young_1/status/1933337112373293452?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet13', url: 'https://twitter.com/Rory_Johnston/status/1933369800035872980', title: 'Iran says Israel Attack Could Not Have Been Done Without US', meta: 'June 13, 2025 ‚Ä¢ Rory Johnston (@Rory_Johnston)', category: 'Policy', tweetContent: '<p lang="en" dir="ltr">*IRAN SAYS ISRAEL ATTACK COULD NOT HAVE BEEN DONE WITHOUT US<br><br>*IRAN: US WILL BE HELD RESPONSIBLE FOR ISRAEL&#39;S ATTACK</p>&mdash; Rory Johnston (@Rory_Johnston) <a href="https://twitter.com/Rory_Johnston/status/1933369800035872980?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet12', url: 'https://twitter.com/Rory_Johnston/status/1933356845143572942', title: 'Prompt Brent Timespread Rockets', meta: 'June 13, 2025 ‚Ä¢ Rory Johnston (@Rory_Johnston)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">OH MY GOD<br><br>Prompt Brent timespread rockets to near $4/bbl.<br><br>We&#39;re talking 2022 Russian invasion levels. <a href="https://t.co/EiLj7A4rO7">pic.twitter.com/EiLj7A4rO7</a></p>&mdash; Rory Johnston (@Rory_Johnston) <a href="https://twitter.com/Rory_Johnston/status/1933356845143572942?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet11', url: 'https://twitter.com/Amena__Bakr/status/1933348851982680520', title: 'Oil Prices Surge on Israeli Strikes in Tehran', meta: 'June 13, 2025 ‚Ä¢ Amena Bakr (@Amena__Bakr)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">Reports of Israel attacking 6 military sites around Tehran pushed oil prices up by another 5 dollars <a href="https://twitter.com/hashtag/OOTT?src=hash&ref_src=twsrc%5Etfw">#OOTT</a> <a href="https://t.co/XxfnMwXNxy">pic.twitter.com/XxfnMwXNxy</a></p>&mdash; Amena Bakr (@Amena__Bakr) <a href="https://twitter.com/Amena__Bakr/status/1933348851982680520?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet10', url: 'https://twitter.com/GasBuddyGuy/status/1933318569753763959', title: 'Oil Could Surge $5-$10/bbl on Iran Situation', meta: 'June 13, 2025 ‚Ä¢ Patrick De Haan (@GasBuddyGuy)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">Oil could surge $5-$10/bbl in the days ahead if the situation with Iran deteriorates amidst the summer driving season and rising oil demand..: this could be big.</p>&mdash; Patrick De Haan (@GasBuddyGuy) <a href="https://twitter.com/GasBuddyGuy/status/1933318569753763959?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet9', url: 'https://twitter.com/Rory_Johnston/status/1933316954355532031', title: 'Crude Surging on Israeli Strike on Iran', meta: 'June 13, 2025 ‚Ä¢ Rory Johnston (@Rory_Johnston)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">üö® Crude surging $3+/bbl on Israeli strike on Iran.<br><br>Brent over $73/bbl <a href="https://t.co/gE72Dlcfxv">pic.twitter.com/gE72Dlcfxv</a></p>&mdash; Rory Johnston (@Rory_Johnston) <a href="https://twitter.com/Rory_Johnston/status/1933316954355532031?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet8', url: 'https://twitter.com/WhiteHouse/status/1933328486669697508', title: 'Secretary of State Marco Rubio on Israeli Action Against Iran', meta: 'June 13, 2025 ‚Ä¢ The White House (@WhiteHouse)', category: 'Policy', tweetContent: '<p lang="en" dir="ltr">Statement from Secretary of State Marco Rubio<br><br>‚ÄúTonight, Israel took unilateral action against Iran. We are not involved in strikes against Iran and our top priority is protecting American forces in the region. Israel advised us that they believe this action was necessary for its‚Ä¶ <a href="https://t.co/5FFesh3dkF">pic.twitter.com/5FFesh3dkF</a></p>&mdash; The White House (@WhiteHouse) <a href="https://twitter.com/WhiteHouse/status/1933328486669697508?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet7', url: 'https://twitter.com/Rory_Johnston/status/1933323720073863382', title: 'US Aware of Strike Reports, No Involvement', meta: 'June 13, 2025 ‚Ä¢ Rory Johnston (@Rory_Johnston)', category: 'Policy', tweetContent: '<p lang="en" dir="ltr">FT: ‚ÄúUS official said Washington was ‚Äúaware of the reports of strikes‚Äù and that ‚Äúthere was no US involvement or US assistance‚Äù to Israel during the operation.‚Äù</p>&mdash; Rory Johnston (@Rory_Johnston) <a href="https://twitter.com/Rory_Johnston/status/1933323720073863382?ref_src=twsrc%5Etfw">June 13, 2025</a>' },
            { id: 'tweet6', url: 'https://twitter.com/OilHeadlineNews/status/1933309259581690275', title: 'Israeli Attack on Iran Could Send Oil Prices Above $100', meta: 'June 12, 2025 ‚Ä¢ Energy Headline News (@OilHeadlineNews)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">An Israeli attack on Iran could send oil prices above $100 as tensions mount - CNBC</p>&mdash; Energy Headline News (@OilHeadlineNews) <a href="https://twitter.com/OilHeadlineNews/status/1933309259581690275?ref_src=twsrc%5Etfw">June 12, 2025</a>' },
            { id: 'tweet5', url: 'https://twitter.com/Amena__Bakr/status/1933201079761568005', title: 'Reaching a Deal with Iran Will Help on Oil Prices', meta: 'June 12, 2025 ‚Ä¢ Amena Bakr (@Amena__Bakr)', category: 'Policy', tweetContent: '<p lang="en" dir="ltr">Reaching a deal with Iran will help on that front <a href="https://twitter.com/hashtag/Trump?src=hash&ref_src=twsrc%5Etfw">#Trump</a> <a href="https://twitter.com/hashtag/OOTT?src=hash&ref_src=twsrc%5Etfw">#OOTT</a> <a href="https://t.co/hStELUHwii">https://t.co/hStELUHwii</a></p>&mdash; Amena Bakr (@Amena__Bakr) <a href="https://twitter.com/Amena__Bakr/status/1933201079761568005?ref_src=twsrc%5Etfw">June 12, 2025</a>' },
            { id: 'tweet4', url: 'https://twitter.com/JavierBlas/status/1933185348839829763', title: 'Trump: Don\'t Like Oil Prices Have Gone Up', meta: 'June 12, 2025 ‚Ä¢ Javier Blas (@JavierBlas)', category: 'Crude oil', tweetContent: '<p lang="en" dir="ltr">TRUMP: DON&#39;T LIKE OIL PRICES HAVE GONE UP<br><br>(Yeah, that&#39;s the problem when energy traders hear chatter about someone thinking about bombing Iran: oil prices do tend to increase) <a href="https://twitter.com/hashtag/OOTT?src=hash&ref_src=twsrc%5Etfw">#OOTT</a></p>&mdash; Javier Blas (@JavierBlas) <a href="https://twitter.com/JavierBlas/status/1933185348839829763?ref_src=twsrc%5Etfw">June 12, 2025</a>' },
            { id: 'tweet3', url: 'https://twitter.com/JavierBlas/status/1933188916909384163', title: 'US President Donald Trump Addresses Energy Secretary Chris Wright', meta: 'June 12, 2025 ‚Ä¢ Javier Blas (@JavierBlas)', category: 'Policy', tweetContent: '<p lang="en" dir="ltr">US President Donald Trump speaking at the White House today and referring directly to US Secretary of Energy Chris Wright (in the audience): <a href="https://t.co/0ASgiAAQTU">pic.twitter.com/0ASgiAAQTU</a></p>&mdash; Javier Blas (@JavierBlas) <a href="https://twitter.com/JavierBlas/status/1933188916909384163?ref_src=twsrc%5Etfw">June 12, 2025</a>' },
            { id: 'tweet2', url: 'https://twitter.com/JavierBlas/status/1933238166267572705', title: 'New CACTUS Trade: Crude Aspirations Crimp Trump‚Äôs Unilateral Strategy', meta: 'June 12, 2025 ‚Ä¢ Javier Blas (@JavierBlas)', category: 'Market Analysis', tweetContent: '<p lang="en" dir="ltr">From an oil industry insider: <br><br>‚ÄúThe new CACTUS Trade: Crude Aspirations Crimp Trump‚Äôs Unilateral Strategy‚Äù<br><br>(CACTUS is also the name of a pair of key oil pipelines in Texas) <a href="https://twitter.com/hashtag/OOTT?src=hash&ref_src=twsrc%5Etfw">#OOTT</a></p>&mdash; Javier Blas (@JavierBlas) <a href="https://twitter.com/JavierBlas/status/1933238166267572705?ref_src=twsrc%5Etfw">June 12, 2025</a>' },
            { id: 'tweet1', url: 'https://twitter.com/IsraeliPM/status/1933244843624407170', title: 'PM Netanyahu\'s Remarks with Argentine President Milei', meta: 'June 12, 2025 ‚Ä¢ Prime Minister of Israel (@IsraeliPM)', category: 'Policy', tweetContent: '<p lang="en" dir="ltr">WATCH: Prime Minister Benjamin Netanyahu&#39;s remarks, today, at the signing of MOUs with Argentine President <a href="https://twitter.com/JMilei?ref_src=twsrc%5Etfw">@JMilei</a>.<br><br>&quot;We feel your heart, your connection to our people, to our land, to our state, and our eternal united city, Jerusalem.&quot;<a href="https://t.co/7wtikaq9GC">https://t.co/7wtikaq9GC</a> <a href="https://t.co/clKlE7t7DY">pic.twitter.com/clKlE7t7DY</a></p>&mdash; Prime Minister of Israel (@IsraeliPM) <a href="https://twitter.com/IsraeliPM/status/1933244843624407170?ref_src=twsrc%5Etfw">June 12, 2025</a>'}
        ];

        // --- AUTH & HEADER LOGIC ---
        // ‚úÖ 3. This is now handled by headerManager.js. The old initializeHeaderAndAuth function has been removed.

        // --- DYNAMIC RENDERING & FILTERING ---
        function displayCommunityPostsPage(postsToDisplay) {
            const postsContainerCommunity = document.getElementById('postsContainerCommunity');
            if (!postsContainerCommunity) return;

            postsContainerCommunity.innerHTML = '';
            if (postsToDisplay.length === 0) {
                postsContainerCommunity.innerHTML = '<p class="text-center text-gray-500 py-8">No posts match your current filters.</p>';
                return;
            }
            postsToDisplay.forEach(post => {
                const postElement = document.createElement('article');
                postElement.className = 'post-card';
                const isFavorited = communityFavorites.includes(String(post.id));

                postElement.innerHTML = `
                    <p class="post-title">${post.title || 'Untitled Post'}</p>
                    <p class="post-meta">${post.meta || 'N/A'} <span class="post-category-tag">${post.category || 'General'}</span></p>
                    <div class="twitter-tweet-container is-loading">
                        <blockquote class="twitter-tweet" data-theme="dark" data-cards="hidden" data-conversation="none">${post.tweetContent || ''}</blockquote>
                    </div>
                    <div class="post-actions">
                        <span class="share-confirmation hidden" style="margin-right: auto;">Linq copied!</span>
                        <button class="action-btn favorite-btn ${isFavorited ? 'favorited' : ''}" data-id="${post.id}" aria-label="Toggle Favorite">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 4h6a2 2 0 0 1 2 2v14l-5 -3l-5 3v-14a2 2 0 0 1 2 -2" /></svg>
                        </button>
                        <button class="action-btn share-btn" data-id="${post.id}" data-title="${post.title || 'Untitled Post'}"><i class="fas fa-share-alt"></i></button>
                    </div>
                `;
                postsContainerCommunity.appendChild(postElement);
            });

            if (window.twttr && window.twttr.widgets) window.twttr.widgets.load(postsContainerCommunity);
        }

        function filterAndDisplayPosts() {
            const searchQuery = document.getElementById('searchInputCommunity').value.toLowerCase().trim();
            const activeCategories = Array.from(document.querySelectorAll('#categoryFiltersCommunity .filter-button.active')).map(btn => btn.dataset.category);
            
            let filteredPosts = communityPostsDataPage;
            if (activeCategories.length > 0) {
                filteredPosts = filteredPosts.filter(post => activeCategories.includes(post.category));
            }
            if (searchQuery) {
                filteredPosts = filteredPosts.filter(post =>
                    (post.title && post.title.toLowerCase().includes(searchQuery)) ||
                    (post.meta && post.meta.toLowerCase().includes(searchQuery)) ||
                    (post.category && post.category.toLowerCase().includes(searchQuery))
                );
            }
            displayCommunityPostsPage(filteredPosts);
        }

        // --- BOOKMARKING ---
        async function toggleCommunityFavorite(postId) {
            const user = firebase.auth().currentUser;
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            const idStr = String(postId);
            const isCurrentlyFavorited = communityFavorites.includes(idStr);

            const userRef = db.collection('users').doc(user.uid);
            const updateData = {
                communityBookmarks: isCurrentlyFavorited 
                    ? firebase.firestore.FieldValue.arrayRemove(idStr) 
                    : firebase.firestore.FieldValue.arrayUnion(idStr)
            };
            await userRef.set(updateData, { merge: true }).catch(error => {
                console.error("Firestore community bookmark update failed:", error);
            });
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('current-year-community').textContent = new Date().getFullYear();

            const twitterScript = document.createElement('script');
            twitterScript.src = 'https://platform.twitter.com/widgets.js';
            twitterScript.async = true;
            twitterScript.charset = 'utf-8';
            document.body.appendChild(twitterScript);

            if (window.twttr) {
                window.twttr.ready(twttr => {
                    twttr.events.bind('rendered', function (event) {
                        if (event.target) {
                            const tweetContainer = event.target.closest('.twitter-tweet-container');
                            if (tweetContainer) {
                                tweetContainer.classList.remove('is-loading');
                            }
                        }
                    });
                });
            }

            document.getElementById('postsContainerCommunity').addEventListener('click', function(event) {
                const favoriteButton = event.target.closest('.favorite-btn');
                if (favoriteButton) {
                    toggleCommunityFavorite(favoriteButton.dataset.id);
                    return;
                }
                const shareButton = event.target.closest('.share-btn');
                if (shareButton) {
                    handleShareClick(shareButton);
                }
            });

            document.querySelectorAll('#categoryFiltersCommunity .filter-button').forEach(button => {
                button.addEventListener('click', () => {
                    button.classList.toggle('active');
                    filterAndDisplayPosts();
                });
            });

            document.getElementById('searchInputCommunity').addEventListener('input', filterAndDisplayPosts);

            // This listener now correctly initializes the rest of the page logic
            firebase.auth().onAuthStateChanged(user => {
                if (unsubscribeUserListener) unsubscribeUserListener();
                if (user) {
                    unsubscribeUserListener = db.collection('users').doc(user.uid).onSnapshot(doc => {
                        communityFavorites = doc.exists ? doc.data().communityBookmarks || [] : [];
                        filterAndDisplayPosts();
                    }, err => {
                        console.error("Error listening to community bookmarks:", err);
                        communityFavorites = [];
                        filterAndDisplayPosts();
                    });
                } else {
                    communityFavorites = [];
                    filterAndDisplayPosts();
                }
                // Also update the active nav link status
                setActiveNavLink();
            });
        });
        
        // --- UTILITY FUNCTIONS ---
        function setActiveNavLink() {
            const currentPath = window.location.pathname.split("/").pop() || "index.html";
            document.querySelectorAll('#header-placeholder a.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPath) link.classList.add('active');
            });
        }
        
        function handleShareClick(button) {
            const postId = button.dataset.id;
            const shareUrl = `${window.location.origin}${window.location.pathname.replace('community.html', 'share.html')}?postId=${postId}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                const confirmation = button.closest('.post-actions').querySelector('.share-confirmation');
                if(confirmation) {
                    confirmation.style.display = 'inline';
                    setTimeout(() => { confirmation.style.display = 'none'; }, 2500);
                }
            }).catch(err => console.error('Failed to copy share link:', err));
        }
    </script>
    
    <!-- ‚úÖ 4. Add the Centralized Header Logic -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script>
        // Minimal Firebase init
        const firebaseConfig = {
            apiKey: "AIzaSyD_FCx8sIkrCoQMoKm5xQIvlyAmlqptETk",
            authDomain: "linq-b27a8.firebaseapp.com",
            projectId: "linq-b27a8",
            storageBucket: "linq-b27a8.appspot.com",
            messagingSenderId: "1067901051826",
            appId: "1:1067901051826:web:44452d1339cdbe2af07aab"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    </script>
    <script src="headerManager.js" defer></script>

</body>
</html>
